{% extends 'base.html' %}
{% load static %}

{% block site_header %}
<header class="site-header">
  <div class="logo"><img src="{% static 'images/admitionwala_logo.svg' %}" alt="AdmitionWala"/></div>
  <button class="menu-toggle" aria-label="Open menu" aria-expanded="false">
    <svg viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <g stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <path class="bar-top" d="M2 3h20" />
        <path class="bar-mid" d="M2 9h20" />
        <path class="bar-bot" d="M2 15h20" />
      </g>
    </svg>
  </button>
</header>
{% endblock %}

{% block content %}
<div class="robo-counsel-box" style="max-width:600px;margin:48px auto 0 auto;background:rgba(255,255,255,0.82);border-radius:18px;box-shadow:0 4px 24px rgba(0,0,0,0.10);padding:32px 18px;position:relative;overflow:hidden;">
  <h3 class="accent-text" style="font-size:1.5em;font-weight:900;color:#222;background:rgba(255,255,255,0.92);padding:0.2em 0.6em;border-radius:8px;display:inline-block;box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-bottom:18px;">Ask AdmitionWala Robo (in Marathi)</h3>
  <input id="user-question-input" type="text" placeholder="तुमचा प्रश्न विचारा..." class="input-accent" style="width:100%;margin-bottom:10px;font-weight:700;color:#222;" autocomplete="off" />
  <div id="robo-answer" class="accent-text" style="margin-top:18px;font-weight:700;color:#222;"></div>
  <div class="animated bounce" style="text-align:center;margin-bottom:24px;">
    <h2 class="accent-text" style="font-size:2em;margin-bottom:6px;color:#222;font-weight:900;background:rgba(255,255,255,0.92);padding:0.2em 0.6em;border-radius:8px;display:inline-block;box-shadow:0 2px 8px rgba(0,0,0,0.08);">AdmitionWala Robo</h2>
    <div id="ai-marathi-greeting" style="color:#222;font-size:1.1em;font-weight:700;">नमस्कार, आपले स्वागत आहे! मी AdmitionWala Robo आहे. कृपया आपली माहिती द्या.</div>
    <button id="speak-greeting-btn" style="margin-top:10px;background:#2e7d32;color:white;padding:7px 18px;border:none;border-radius:6px;font-size:1em;font-weight:700;cursor:pointer;">Speak</button>
  </div>
  <div id="ai-marathi-form" class="panel" style="max-width:420px;margin:32px auto 0 auto;background:rgba(255,255,255,0.96);border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08);padding:18px;">
    <div id="ai-marathi-question" style="font-weight:700;margin-bottom:12px;color:#222;" class="accent-text"></div>
    <form id="ai-marathi-form-el" method="POST" style="margin:0;">
      {% csrf_token %}
      <input id="ai-marathi-input" name="ai-marathi-input" type="text" class="input-accent" style="width:100%;margin-bottom:10px;font-weight:700;color:#222;background:#fff;" autofocus />
      <button id="ai-marathi-next" type="button" class="accent-btn full-width" style="font-weight:700;">पुढे</button>
    </form>
    <div id="ai-marathi-response" class="accent-text" style="margin-top:18px;font-weight:700;color:#222;"></div>
  </div>
</div>

<script>
// Simple rule-based Marathi answers (expand as needed)
function getMarathiAnswer(q) {
  q = q.trim();
  if (!q) return '';
  if (q.includes('नमस्कार') || q.includes('hello') || q.includes('हाय') || q.includes('hi') || q.includes('स्वागत'))
    return 'नमस्कार! मी AdmitionWala Robo आहे. तुम्ही मला कोणताही प्रश्न विचारू शकता.';
  if (q.includes('कोर्स') || q.includes('course')) return 'आमच्या कॉलेजमध्ये विविध कोर्सेस उपलब्ध आहेत. कृपया अधिक माहितीसाठी कोर्स यादी पहा.';
  if (q.includes('फीस') || q.includes('fees')) return 'फीस कॉलेज आणि कोर्सनुसार वेगवेगळी असते. कृपया तपशीलवार माहिती कॉलेज पेजवर पहा.';
  if (q.includes('प्रवेश') || q.includes('admission')) return 'प्रवेश प्रक्रियेबद्दल अधिक माहितीसाठी आमच्या सल्लागाराशी संपर्क साधा.';
  if (q.includes('पत्ता') || q.includes('address')) return 'कॉलेजचा पत्ता कॉलेज पेजवर दिला आहे.';
  if (q.includes('शुभेच्छा') || q.includes('thanks') || q.includes('धन्यवाद')) return 'आपले स्वागत आहे!';
  if (q.includes('commerce') || q.includes('कॉमर्स')) return 'कॉमर्स क्षेत्रासाठी आमच्याकडे B.Com, BBA, आणि इतर कोर्सेस उपलब्ध आहेत. अधिक माहितीसाठी कोर्स यादी पहा.';
  return 'माफ करा, मी तुमचा प्रश्न समजू शकलो नाही. कृपया अधिक स्पष्टपणे विचारा.';
}

function speakMarathi(msg) {
  if ('speechSynthesis' in window && msg) {
    window.speechSynthesis.cancel();
    var utter = new SpeechSynthesisUtterance(msg);
    utter.rate = 0.95; utter.pitch = 0.7; utter.volume = 1;
    utter.lang = 'mr-IN';
    window.speechSynthesis.speak(utter);
  }
}

document.addEventListener('DOMContentLoaded', function() {
  var userQInput = document.getElementById('user-question-input');
  var roboAnsDiv = document.getElementById('robo-answer');
  if (userQInput) {
    userQInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        var q = userQInput.value;
        if (!q) { speakMarathi('कृपया प्रश्न विचारा.'); return; }
        var ans = getMarathiAnswer(q);
        roboAnsDiv.innerText = ans; speakMarathi(ans);
      }
    });
  }

  var speakBtn = document.getElementById('speak-greeting-btn');
  if (speakBtn) {
    speakBtn.onclick = function() { speakMarathi('नमस्कार, आपले स्वागत आहे! मी AdmitionWala Robo आहे. कृपया आपली माहिती द्या.'); };
  }

  const questions = [
    'नमस्कार, आपले स्वागत आहे! मी आपला ॲडमिशन सहाय्यक आहे. तुमचं नाव काय आहे?',
    'तुमची आवड किंवा क्षेत्र सांगा (उदा. अभियांत्रिकी, वैद्यकीय, वाणिज्य)',
    'तुमचा अंदाजे बजेट (हजारात) सांगा.',
    'कोणते शहर किंवा ठिकाण प्राधान्य आहे?'
  ];
  let answers = [];
  let step = 0;
  const qDiv = document.getElementById('ai-marathi-question');
  const input = document.getElementById('ai-marathi-input');
  const nextBtn = document.getElementById('ai-marathi-next');
  const formEl = document.getElementById('ai-marathi-form-el');

  function askQuestion() {
    input.value = '';
    input.type = (step === 2) ? 'number' : 'text';
    input.placeholder = (step === 2) ? 'उदा. 200' : '';
    qDiv.innerText = questions[step];
    speakMarathi(questions[step]);
    input.focus();
  }

  nextBtn.addEventListener('click', function greetFirst() {
    if (step === 0 && answers.length === 0) {
      speakMarathi('नमस्कार, आपले स्वागत आहे! मी आपला ॲडमिशन सहाय्यक आहे. कृपया आपली माहिती द्या.');
      setTimeout(askQuestion, 600);
      return;
    }
  }, { once: true });
  askQuestion();

  nextBtn.onclick = function() {
    let val = input.value.trim();
    if (!val) { speakMarathi('कृपया उत्तर द्या.'); return; }
    answers.push(val); step++;
    if (step < questions.length) { askQuestion(); }
    else {
      input.style.display = 'none'; nextBtn.style.display = 'none';
      let [name, interest, budget, location] = answers;
      formEl.innerHTML += `<input type="hidden" name="name" value="${name}">`;
      formEl.innerHTML += `<input type="hidden" name="interest" value="${interest}">`;
      formEl.innerHTML += `<input type="hidden" name="budget" value="${budget}">`;
      formEl.innerHTML += `<input type="hidden" name="location" value="${location}">`;
      formEl.submit();
    }
  };

});
</script>

{% if completed %}
<div class="animated fadeIn" style="margin-top:32px;text-align:center;">
  <h3 class="accent-text">धन्यवाद, {{ name }}!</h3>
  <div style="margin:12px 0;">Your personalized counseling summary:</div>
  <div id="counselor-summary" class="panel" style="font-size:1.1em;font-weight:500;color:#222;max-width:600px;margin:0 auto 18px auto;padding:18px 12px;border-radius:10px;">{{ summary }}</div>
  <button id="speak-summary-btn" style="background:#2e7d32;color:white;padding:8px 22px;border:none;border-radius:6px;font-size:1em;font-weight:600;cursor:pointer;">Speak Summary</button>
  <div style="margin-top:18px;">Your interest: <b>{{ interest }}</b> | Budget: <b>{{ budget }}</b> | Location: <b>{{ location }}</b></div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var speakBtn = document.getElementById('speak-summary-btn');
  var summaryText = document.getElementById('counselor-summary').innerText;
  if (speakBtn) {
    speakBtn.onclick = function() { speakMarathi(summaryText); };
    speakMarathi(summaryText);
  }
});
</script>
{% endif %}

{% endblock %}
